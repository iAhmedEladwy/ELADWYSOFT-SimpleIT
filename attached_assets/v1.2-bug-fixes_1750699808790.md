
# SimpleIT v1.2 Bug Fixes Plan

## Executive Summary

This document outlines critical bugs identified during testing and provides a comprehensive plan to fix them. Issues span across Tickets, Employees, Assets, Asset History, and System Configuration modules.

---

## Critical Issues Analysis

### 1. Dashboard Active Tickets Count ‚úÖ COMPLETED
**Issue**: Active tickets showing 0 when there are Open/In Progress tickets.
**Status**: Fixed - Updated to count both "Open" and "In Progress" tickets.
**Files Modified**: `server/routes.ts` - `/api/dashboard/summary` endpoint

---

## Tickets Module Issues

### 2. Employee CRUD Operations (400/404 Errors) üî¥ HIGH PRIORITY
**Issue**: Add, update, and delete operations failing with HTTP errors.
**Root Cause**: Database schema conflict - `name` column is generated and cannot be updated directly.
**Error**: `column "name" can only be updated to DEFAULT`
**Investigation**:
- Employee update tries to set generated column `name`
- Drizzle ORM update method includes computed fields
- Missing proper field mapping between frontend and database schema
**Files to Check**:
- `server/storage.ts` - updateEmployee method (line 636)
- `server/routes.ts` - employee update endpoint (line 1145)
- `client/src/pages/Employees.tsx` - update mutation
**Solution**: Exclude generated columns from update operations
**Priority**: High

### 3. Ticket Update Issues üî¥ HIGH PRIORITY
**Issue**: General ticket update problems reported.
**Root Cause**: Request type enum validation failures and form field mapping issues.
**Error**: `invalid input value for enum ticket_request_type: "Support"`
**Investigation**: 
- Ticket form sends hardcoded request types not matching database enum
- Database expects specific enum values but form sends custom values
- Mixed authentication context usage across components
**Files to Check**: 
- `client/src/components/tickets/TicketForm.tsx`
- `client/src/components/tickets/TicketUpdateForm.tsx`
- `server/routes.ts` - ticket update endpoints
- `server/storage.ts` - updateTicketWithHistory method (line 2223)
**Priority**: High

### 4. Ticket History Display Issue üî¥ HIGH PRIORITY
**Issue**: Ticket History doesn't show historical data correctly.
**Root Cause**: Working correctly based on console logs, but UI may have rendering issues.
**Investigation**: 
- API endpoint returns data correctly: `GET /api/tickets/12/history 200`
- Database has proper history entries
- Frontend component may not display data properly
**Files to Check**: 
- `client/src/components/tickets/EnhancedTicketTable.tsx`
- History display components
**Priority**: High

### 5. Tickets Assigned To Shows Employees Instead of Users üü° MEDIUM PRIORITY
**Issue**: Assignment dropdown shows employees instead of users in edit form vs grid.
**Root Cause**: Inconsistent data source between grid and form components.
**Solution**: Standardize to use `/api/users` for all ticket assignments.
**Files to Modify**:
- `client/src/components/tickets/TicketForm.tsx` (line 7: TicketForm component)
- `client/src/components/tickets/TicketUpdateForm.tsx`
- Ensure both use users query instead of employees
**Priority**: Medium

### 6. Start Tracking Function Not Working üü° MEDIUM PRIORITY
**Issue**: Time tracking doesn't reflect real status.
**Root Cause**: UI state management issue with tracking status updates.
**Investigation**: API endpoints work but UI doesn't update tracking status
**Files to Check**: 
- Ticket time tracking components
- State management for tracking status
**Priority**: Medium

### 7. Request Type Hard-coded Data ‚ö†Ô∏è PARTIALLY FIXED
**Issue**: Should populate from custom request types in System config.
**Status**: TicketForm already uses `/api/request-types` endpoint
**Verification Needed**: Check if custom request types are properly populated
**Files to Check**:
- `client/src/components/tickets/TicketForm.tsx` (line 7: already uses custom request types)
- Verify System Config custom request types creation
**Priority**: Low

### 8. Remove Tabbed Filtration and Add User Filter üü° MEDIUM PRIORITY
**Issue**: Current tabbed interface should be replaced with user-based filtering.
**Requirements**:
- Remove status-based tabs
- Add user filter dropdown
- Show "(Current)" beside logged-in user
**Files to Modify**:
- `client/src/pages/Tickets.tsx` (Tabs component removal)
- Add user-based filtering logic
**Priority**: Medium

---

## Employee Module Issues

### 9. Employee Management CRUD Errors (400/404) üî¥ CRITICAL
**Issue**: Add, update, delete operations failing.
**Root Cause**: Database schema conflict with generated columns.
**Error Details**:
```
Error updating employee: error: column "name" can only be updated to DEFAULT
Detail: Column "name" is a generated column.
```
**Investigation**:
- `updateEmployee` method in storage.ts tries to update computed field
- Need to exclude generated columns from update operations
- Mapping between frontend data and database schema incorrect
**Files to Fix**:
- `server/storage.ts` - updateEmployee method
- Remove `name`, `email`, `phone` from update operations (use only new schema fields)
**Priority**: Critical

### 10. Employee Filtration Issues üü° MEDIUM PRIORITY
**Issue**: Filtrations have no titles and duplicate Department/Type values.
**Root Cause**: Data processing in frontend filters doesn't handle null/duplicate values.
**Files to Check**:
- `client/src/pages/Employees.tsx` - filter logic (departments/employmentTypes useMemo)
- Add proper null handling and deduplication
**Priority**: Medium

---

## Asset Module Issues

### 11. Factory OS Field Issues üü° MEDIUM PRIORITY
**Issue**: Shows error when editing asset and left empty, needs name change to "Installed OS".
**Root Cause**: Form validation or empty field handling issue.
**Files to Modify**:
- `client/src/components/assets/AssetForm.tsx` (outOfBoxOs field)
- Change label from "Factory OS" to "Installed OS"
- Fix empty field validation
**Priority**: Low

### 12. Asset Maintenance Tab Shows No Records üü° MEDIUM PRIORITY
**Issue**: Maintenance tab doesn't display maintenance records.
**Root Cause**: API endpoint works correctly (console shows 200 response), UI component issue.
**Investigation**:
- API: `GET /api/assets/132/maintenance 200` returns data
- Component rendering or data mapping issue
**Files to Check**:
- `client/src/components/assets/AssetDetailView.tsx`
- Maintenance tab rendering logic
**Priority**: Medium

### 13. Add Asset Column Selection Feature üü¢ LOW PRIORITY
**Issue**: Missing option to select which columns to display in assets table.
**Requirements**:
- Add column visibility controls
- Save user preferences
- Implement responsive column hiding
**Files to Modify**:
- `client/src/components/assets/AssetsTable.tsx`
- Add column management component
**Priority**: Low

### 14. Add Asset Filtrations (Type, Brand, Model Name) üü° MEDIUM PRIORITY
**Issue**: Missing filter options for assets.
**Requirements**:
- Add filter dropdowns for Type, Brand, Model Name
- Implement search functionality
- Add filter reset option
**Files to Modify**:
- `client/src/components/assets/AssetsTable.tsx`
- `client/src/pages/Assets.tsx`
**Priority**: Medium

---

## Asset History Module Issues

### 15. Asset History Data Display Issue üü° MEDIUM PRIORITY
**Issue**: Asset History module doesn't show data correctly.
**Root Cause**: API endpoint or data transformation issue.
**Investigation**:
- Test asset history API endpoints
- Check data fetching and rendering
- Verify transaction history display
**Files to Check**:
- `client/src/pages/AssetHistory.tsx`
- `client/src/components/assets/TransactionHistoryTable.tsx`
**Priority**: Medium

### 16. Add Pagination to Asset History üü¢ LOW PRIORITY
**Issue**: Need option to limit results per page.
**Requirements**:
- Implement pagination controls
- Add page size selector
- Update API to support pagination
**Files to Modify**:
- `client/src/pages/AssetHistory.tsx`
- `server/routes.ts` - asset history endpoints
**Priority**: Low

### 17. Side Navigation Hide Issue üü¢ LOW PRIORITY
**Issue**: Can't hide side navigation while on Asset History page.
**Root Cause**: Layout component state management issue.
**Solution**: Fix sidebar toggle functionality for this specific page.
**Files to Check**:
- `client/src/components/layout/Layout.tsx`
- `client/src/pages/AssetHistory.tsx`
**Priority**: Low

---

## System Configuration Issues

### 18. Department Tab State Management ‚úÖ PARTIALLY IMPLEMENTED
**Issue**: After CRUD operations, doesn't stay on same tab.
**Status**: Tab state management exists, need to verify it works for all CRUD operations.
**Verification Needed**:
- Test add/edit/delete operations
- Ensure `activeTab` state persists
**Files to Check**:
- `client/src/pages/SystemConfig.tsx`
**Priority**: Low

### 19. Import/Export Functions Not Working üü° MEDIUM PRIORITY
**Issue**: Incorrect mapping causing import/export failures.
**Root Cause**: Data field mapping inconsistencies between export and import.
**Investigation**:
- Test import/export for all modules
- Verify field mappings
- Check CSV format consistency
**Files to Check**:
- `server/routes.ts` - import/export endpoints
- `shared/csvUtils.ts`
- `shared/importExportRules.ts`
**Priority**: Medium

### 20. Remove Demo Data Error 500 üîç NEEDS INVESTIGATION
**Issue**: Remove demo data function returns server error.
**Root Cause**: Likely foreign key constraint violations during deletion.
**Investigation**:
- Check deletion order in `removeDemoData` method
- Implement proper cascading deletes
- Add transaction handling
**Files to Check**:
- `server/storage.ts` - removeDemoData method
- Database foreign key constraints
**Priority**: Medium

---

## Implementation Priority Matrix

### High Priority (Fix First)
1. ‚úÖ Dashboard Active Tickets Count (COMPLETED)
2. Employee CRUD Operations (400/404 errors)
3. Ticket Update Issues
4. Ticket History Display Issue

### Medium Priority (Fix Second)
5. Assets by Type Display Issue
6. Tickets Assigned To Shows Employees
7. Start Tracking Function
8. Remove Tabbed Filtration and Add User Filter
9. Employee Filtration Issues
10. Asset Maintenance Tab Shows No Records
11. Add Asset Filtrations
12. Asset History Data Display Issue
13. Import/Export Functions Not Working
14. Remove Demo Data Error 500

### Low Priority (Fix Last)
15. Request Type Hard-coded Data (verify fix)
16. Factory OS Field Issues
17. Add Asset Column Selection Feature
18. Add Asset History Pagination
19. Side Navigation Hide Issue
20. Department Tab State Management (verify fix)

---

## Implementation Timeline

### Phase 1: Critical Fixes (Week 1)
- Fix employee CRUD operations
- Resolve ticket update issues
- Fix ticket history display

### Phase 2: Core Functionality (Week 2)
- Fix assets by type display
- Resolve ticket assignment issues
- Fix time tracking functionality
- Update ticket filtration system

### Phase 3: Data Management (Week 3)
- Fix import/export functions
- Resolve asset maintenance display
- Fix asset history issues
- Fix demo data removal

### Phase 4: UI/UX Improvements (Week 4)
- Add asset column selection
- Implement asset filtrations
- Add pagination features
- Fix navigation issues

---

## Testing Strategy

### Automated Testing
- API endpoint testing for all CRUD operations
- Database constraint testing
- Import/export data validation

### Manual Testing
- User workflow testing for each module
- Cross-browser compatibility testing
- Mobile responsiveness testing

### Regression Testing
- Test all fixed issues after each implementation
- Verify no new issues introduced
- Performance impact assessment

---

## Risk Assessment

### High Risk
- Database schema changes (foreign key constraints)
- Employee deletion with ticket references
- Import/export data integrity

### Medium Risk
- UI component refactoring
- State management changes
- API endpoint modifications

### Low Risk
- Label changes
- Filter additions
- Styling updates

---

## Success Criteria

### Technical Metrics
- All CRUD operations working without errors
- 100% test coverage for critical paths
- Zero console errors in production

### User Experience Metrics
- Smooth workflow completion
- Consistent data display
- Intuitive interface navigation

### Performance Metrics
- Page load times under 2 seconds
- API response times under 500ms
- Database query optimization

---

## Conclusion

This comprehensive plan addresses all identified issues with a structured approach prioritizing critical functionality first. The implementation phases ensure systematic resolution while maintaining system stability and user experience.

**Next Steps**: Begin with Phase 1 critical fixes, focusing on the employee CRUD operations and ticket update issues that are currently blocking core functionality.
